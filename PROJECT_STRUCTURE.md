# é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜ä¸º @mx-space/api-client åˆ›å»ºçš„æ„å»ºç³»ç»Ÿé¡¹ç›®çš„å®Œæ•´ç»“æ„å’Œå„æ–‡ä»¶çš„ä½œç”¨ã€‚

> **é¡¹ç›®èƒŒæ™¯**: ç”±äº mx-space/core ä»“åº“ä¸­çš„ @mx-space/api-client åŒ…æœªå‘å¸ƒåˆ° npmï¼Œæ­¤é¡¹ç›®ä¸ºå¼€å‘è€…æä¾›äº†å¯å®‰è£…çš„æ„å»ºç‰ˆæœ¬ @adminlaowang/mx-space-api-clientã€‚

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
mx-space-api-client-builder/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ build-and-publish.yml    # ä¸»è¦çš„ GitHub Actions å·¥ä½œæµ
â”œâ”€â”€ example/
â”‚   â””â”€â”€ usage.md                     # ä½¿ç”¨ç¤ºä¾‹æ–‡æ¡£
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ build.sh                     # æœ¬åœ°æ„å»ºè„šæœ¬
â”œâ”€â”€ .gitignore                       # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ last_build_commit.txt            # è®°å½•ä¸Šæ¬¡æ„å»ºçš„ commit hash
â”œâ”€â”€ package.json                     # é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ PROJECT_STRUCTURE.md             # æœ¬æ–‡ä»¶ - é¡¹ç›®ç»“æ„è¯´æ˜
â”œâ”€â”€ README.md                        # é¡¹ç›®ä»‹ç»å’Œå¿«é€Ÿå¼€å§‹
â””â”€â”€ SETUP.md                         # è¯¦ç»†è®¾ç½®æŒ‡å—
```

## ğŸ“ æ–‡ä»¶è¯¦ç»†è¯´æ˜

### ğŸš€ æ ¸å¿ƒæ–‡ä»¶

#### `.github/workflows/build-and-publish.yml`
- **ä½œç”¨**: GitHub Actions ä¸»å·¥ä½œæµæ–‡ä»¶
- **åŠŸèƒ½**:
  - è‡ªåŠ¨æ£€æµ‹ mx-space/core ä»“åº“çš„ api-client æºç æ›´æ–°
  - ä¸‹è½½æºç å¹¶æ„å»º TypeScript é¡¹ç›®
  - è¿è¡Œæµ‹è¯•å’Œç±»å‹æ£€æŸ¥
  - å‘å¸ƒä¸º @adminlaowang/mx-space-api-client åˆ° NPM å’Œ GitHub Packages
  - åˆ›å»º GitHub Release
- **è§¦å‘æ¡ä»¶**:
  - æ‰‹åŠ¨è§¦å‘ (workflow_dispatch)
  - å®šæ—¶ä»»åŠ¡ (æ¯å¤© UTC 00:00)
  - æ¨é€åˆ° main åˆ†æ”¯

#### `scripts/build.sh`
- **ä½œç”¨**: æœ¬åœ°æ„å»ºè„šæœ¬
- **åŠŸèƒ½**:
  - å…‹éš† mx-space/core ä»“åº“çš„ api-client ç›®å½•
  - ä¿®å¤ Windows å…¼å®¹æ€§é—®é¢˜
  - å®‰è£…ä¾èµ–å¹¶æ„å»ºé¡¹ç›®
  - éªŒè¯æ„å»ºè¾“å‡º
- **ä½¿ç”¨**: `chmod +x scripts/build.sh && ./scripts/build.sh`

### ğŸ“‹ é…ç½®æ–‡ä»¶

#### `package.json`
- **ä½œç”¨**: é¡¹ç›®åŒ…é…ç½®æ–‡ä»¶
- **å†…å®¹**:
  - é¡¹ç›®å…ƒä¿¡æ¯ (åç§°ã€ç‰ˆæœ¬ã€æè¿°)
  - è„šæœ¬å‘½ä»¤å®šä¹‰
  - å¼€å‘ä¾èµ–å£°æ˜
  - ä»“åº“ä¿¡æ¯

#### `.gitignore`
- **ä½œç”¨**: Git ç‰ˆæœ¬æ§åˆ¶å¿½ç•¥è§„åˆ™
- **å¿½ç•¥å†…å®¹**:
  - æ„å»ºè¾“å‡ºç›®å½• (dist/, src/, temp/)
  - ä¾èµ–ç›®å½• (node_modules/)
  - ç¯å¢ƒå˜é‡æ–‡ä»¶
  - ä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜

#### `last_build_commit.txt`
- **ä½œç”¨**: è®°å½•ä¸Šæ¬¡æ„å»ºçš„æºç  commit hash
- **ç”¨é€”**: 
  - æ£€æµ‹æºç æ˜¯å¦æœ‰æ›´æ–°
  - é¿å…é‡å¤æ„å»ºç›¸åŒç‰ˆæœ¬
  - Actions å·¥ä½œæµè‡ªåŠ¨ç»´æŠ¤

### ğŸ“– æ–‡æ¡£æ–‡ä»¶

#### `README.md`
- **ä½œç”¨**: é¡¹ç›®ä¸»è¦ä»‹ç»æ–‡æ¡£
- **å†…å®¹**:
  - é¡¹ç›®æ¦‚è¿°å’ŒåŠŸèƒ½ç‰¹æ€§
  - å¿«é€Ÿå¼€å§‹æŒ‡å—
  - ä½¿ç”¨æ–¹æ³•è¯´æ˜
  - ç‰ˆæœ¬ç­–ç•¥

#### `SETUP.md`
- **ä½œç”¨**: è¯¦ç»†è®¾ç½®æŒ‡å—
- **å†…å®¹**:
  - ä»“åº“åˆ›å»ºæ­¥éª¤
  - GitHub Secrets é…ç½®
  - æƒé™è®¾ç½®è¯´æ˜
  - æ•…éšœæ’é™¤æŒ‡å—

#### `example/usage.md`
- **ä½œç”¨**: ä½¿ç”¨ç¤ºä¾‹æ–‡æ¡£
- **å†…å®¹**:
  - åŒ…å®‰è£…æ–¹æ³•
  - åŸºæœ¬ API ä½¿ç”¨ç¤ºä¾‹
  - ä¸åŒæ¡†æ¶é›†æˆç¤ºä¾‹
  - TypeScript ç±»å‹æ”¯æŒ

#### `PROJECT_STRUCTURE.md` (æœ¬æ–‡ä»¶)
- **ä½œç”¨**: é¡¹ç›®ç»“æ„è¯´æ˜æ–‡æ¡£
- **å†…å®¹**: æ–‡ä»¶ç»„ç»‡ç»“æ„å’Œå„æ–‡ä»¶ä½œç”¨è¯´æ˜

## ğŸ”„ å·¥ä½œæµç¨‹

### 1. æºç æ£€æµ‹
- Actions å®šæ—¶æ£€æŸ¥ mx-space/core ä»“åº“çš„æ›´æ–°
- æ¯”è¾ƒæœ€æ–° commit hash ä¸ `last_build_commit.txt`
- æœ‰æ›´æ–°æ—¶è§¦å‘æ„å»ºæµç¨‹

### 2. æºç è·å–
- ä½¿ç”¨ Git sparse-checkout åªå…‹éš† packages/api-client ç›®å½•
- å¤åˆ¶æºç åˆ°æ„å»ºå·¥ä½œç›®å½•
- æ¸…ç†ä¸´æ—¶æ–‡ä»¶

### 3. ç¯å¢ƒå‡†å¤‡
- è®¾ç½® Node.js ç¯å¢ƒ (æ”¯æŒå¤šç‰ˆæœ¬æµ‹è¯•)
- å®‰è£… pnpm åŒ…ç®¡ç†å™¨
- ä¿®å¤ Windows å‘½ä»¤å…¼å®¹æ€§é—®é¢˜

### 4. é¡¹ç›®æ„å»º
- å®‰è£…é¡¹ç›®ä¾èµ– (`pnpm install`)
- è¿è¡Œæµ‹è¯•å¥—ä»¶ (`npm test`)
- æ‰§è¡Œæ„å»ºå‘½ä»¤ (`npm run build`)
- éªŒè¯æ„å»ºè¾“å‡ºæ–‡ä»¶

### 5. åŒ…å‘å¸ƒ
- å‡†å¤‡å‘å¸ƒåŒ…æ–‡ä»¶
- æ›´æ–°ç‰ˆæœ¬å· (åŸºäº commit hash æˆ–æ‰‹åŠ¨æŒ‡å®š)
- å‘å¸ƒåˆ° GitHub Packages (é»˜è®¤)
- å‘å¸ƒåˆ° NPM (å¯é€‰ï¼Œéœ€é…ç½® token)

### 6. å‘å¸ƒè®°å½•
- åˆ›å»º GitHub Release å’Œ Git tag
- æ›´æ–°æ„å»ºè®°å½•æ–‡ä»¶
- ä¸Šä¼ æ„å»ºäº§ç‰©ä½œä¸º Artifacts

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ„å»ºé¢‘ç‡
ç¼–è¾‘ `.github/workflows/build-and-publish.yml` ä¸­çš„ cron è¡¨è¾¾å¼:
```yaml
schedule:
  - cron: '0 0 * * *'  # æ¯å¤© UTC 00:00
```

### ä¿®æ”¹ Node.js ç‰ˆæœ¬
æ›´æ–° strategy.matrix.node-version:
```yaml
strategy:
  matrix:
    node-version: [18.x, 20.x, 22.x]
```

### æ·»åŠ é¢å¤–çš„æ„å»ºæ­¥éª¤
åœ¨æ„å»ºä½œä¸šä¸­æ·»åŠ æ–°çš„ steps:
```yaml
- name: è‡ªå®šä¹‰æ­¥éª¤
  run: |
    echo "æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ"
```

## ğŸ› ï¸ ç»´æŠ¤è¯´æ˜

### å®šæœŸæ£€æŸ¥
- ç›‘æ§ Actions è¿è¡ŒçŠ¶æ€
- æ£€æŸ¥æ„å»ºæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
- å…³æ³¨æºä»“åº“ç»“æ„å˜åŒ–

### ä¾èµ–æ›´æ–°
- å®šæœŸæ›´æ–° Actions ç‰ˆæœ¬ (actions/checkout, actions/setup-node ç­‰)
- æ›´æ–° Node.js ç‰ˆæœ¬æ”¯æŒ
- å…³æ³¨ mx-space/core çš„ä¾èµ–å˜åŒ–

### æ•…éšœå¤„ç†
- æŸ¥çœ‹ Actions æ—¥å¿—åˆ†æé”™è¯¯
- æ£€æŸ¥æºä»“åº“çš„ç»“æ„å˜åŒ–
- æ›´æ–°å…¼å®¹æ€§ä¿®å¤è„šæœ¬

## ğŸ”— ç›¸å…³èµ„æº

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [NPM å‘å¸ƒæŒ‡å—](https://docs.npmjs.com/packages-and-modules/contributing-packages-to-the-registry)
- [GitHub Packages æ–‡æ¡£](https://docs.github.com/en/packages)
- [MX Space å®˜æ–¹ä»“åº“](https://github.com/mx-space/core)

è¿™ä¸ªé¡¹ç›®ç»“æ„è®¾è®¡ä½¿å¾—æ•´ä¸ªæ„å»ºå’Œå‘å¸ƒæµç¨‹å®Œå…¨è‡ªåŠ¨åŒ–ï¼ŒåŒæ—¶ä¿æŒäº†è¶³å¤Ÿçš„çµæ´»æ€§ä¾›ç”¨æˆ·è‡ªå®šä¹‰é…ç½®ã€‚